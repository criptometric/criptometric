<script>
const PASSWORD='2025';
let isAdmin=false;
let data={};

const columnsDef=[
  {id:'research',title:'Research'},
  {id:'global',title:'Global M2 Metric'},
  {id:'recession',title:'Recession Metric'},
  {id:'market',title:'Market Metric'},
  {id:'onchain',title:'Onchain Metric'},
  {id:'network',title:'Network Metric'}
];

const columns=document.getElementById('columns');
const logoutBtn=document.getElementById('logoutBtn');
const adminLabel=document.getElementById('adminLabel');

logoutBtn.onclick=()=>{
  isAdmin=false;
  render();
};

// === 행햃햅먫행햌햃 DATA.JSON ===
fetch('data.json')
  .then(res=>res.json())
  .then(json=>{
    data=json;
    render();
  })
  .catch(err=>console.error('뤰걣쟳쐃쥃 향햟햡혞향햨햦 data.json:', err));

// === 먫돯뢇덇돯 ===
function render(){
  document.body.classList.toggle('admin',isAdmin);
  adminLabel.textContent=isAdmin?'ADMIN':'';
  logoutBtn.style.display=isAdmin?'inline-block':'none';

  columns.innerHTML='';
  columnsDef.forEach(col=>{
    if(!data[col.id]) data[col.id]=[];
    const el=document.createElement('div');
    el.className='column';
    el.innerHTML=`
      <div class="col-title">${col.title}</div>
      <div class="col-body"></div>`;
    columns.appendChild(el);

    const body=el.querySelector('.col-body');
    data[col.id].forEach((c,i)=>{
      const card=document.createElement('div');
      card.className='card';
      card.innerHTML=`
        ${isAdmin?`<div class="admin-controls">
          <button onclick="editCard('${col.id}',${i})">九勇</button>
          <button onclick="deleteCard('${col.id}',${i})">游딈</button>
        </div>`:''}
        <div class="card-title">${c.title}</div>
        ${c.image?`<div class="thumb"><img src="${c.image}"></div>`:''}
        <div class="card-text">${c.text}</div>`;
      card.onclick=e=>{
        if(e.target.tagName==='BUTTON')return;
        openView(c);
      };
      body.appendChild(card);
    });
  });
}

// === MODAL ===
function openView(c){
  viewImg.src=c.image||'';
  viewTitle.textContent=c.title;
  viewText.textContent=c.text;
  document.getElementById('viewModal').classList.add('active');
}
function closeView(){
  document.getElementById('viewModal').classList.remove('active');
}

// === LOGIN ===
function login(){
  const pass=document.getElementById('password');
  if(pass.value===PASSWORD){
    isAdmin=true;
    pass.value='';
    document.getElementById('loginPopup').classList.remove('active');
    render();
  } else {
    alert('햏햣쒫왐햫혦햧 햟쮏혧');
  }
}

// === 햌햍햝햖햇뉋뤯 햊햐먫냻뉋햇햏햊햇 ===
function checkAdminMode(){
  const params=new URLSearchParams(window.location.search);
  if(params.get('admin')==='1'){
    document.getElementById('loginPopup').classList.add('active');
  }
}
checkAdminMode();
</script>
